!function(){"use strict";angular.module("mikeslist",["ui.router"]).config(["$httpProvider",function(t){t.interceptors.push("tokenInterceptor")}]).run(["$transitions","$state",function(t,n){t.onError({},function(){n.go("root-state.categories-state")})}]).run(["authenticationService",function(t){t.check()}]).value("globals",{adminEditMode:!1})}();
!function(){"use strict";angular.module("mikeslist").config(["$stateProvider","$locationProvider","$urlRouterProvider",function(e,t,s){s.otherwise("/");var r={name:"root-state",abstract:!0,component:"rootComponent",resolve:{uncategorized:["categoriesService",function(e){return e.getListingsForCategory("uncategorized")}]}},o={name:"root-state.categories-state",url:"/",views:{"content-view":"categoriesComponent"},resolve:{categories:["categoriesService",function(e){return e.getAllCategories()}]}},n={name:"root-state.listings-state",url:"/category/{category}",views:{"content-view":"listingsComponent"},resolve:{category:["categoriesService","$stateParams",function(e,t){return e.getListingsForCategory(t.category)}]}},i={name:"root-state.listing-state",url:"/listing/{listingId}",views:{"content-view":"listingComponent"},resolve:{listing:["listingsService","$stateParams",function(e,t){return e.getListing(t.listingId)}]},params:{category:{}}},a={name:"root-state.new-listing-state",views:{"content-view":"postListingFormComponent"},resolve:{categories:["categoriesService",function(e){return e.getAllCategories()}]}},c={name:"root-state.edit-listing-state",views:{"content-view":"editListingFormComponent"},resolve:{categories:["categoriesService",function(e){return e.getAllCategories()}]},params:{listing:{}}},g={name:"root-state.users-state",url:"/users",resolve:{users:["usersService",function(e){return e.getAllUsers()}]},views:{"content-view":"usersComponent"}},u={name:"root-state.user-state",url:"/user/{email}",resolve:{user:["usersService","$stateParams",function(e,t){return e.getSingleUser(t.email)}]},views:{"content-view":"userComponent"}},l={name:"root-state.new-user-state",views:{"content-view":"createUserFormComponent"}},v={name:"root-state.edit-user-state",views:{"content-view":"editUserFormComponent"},params:{user:{}}};e.state(r),e.state(o),e.state(n),e.state(i),e.state(a),e.state(c),e.state(g),e.state(u),e.state(l),e.state(v),t.html5Mode(!0)}])}();
!function(){angular.module("mikeslist").run(["$templateCache",function(t){t.put("categories-component.tpl",'<ul>\r\n\r\n\t<li ng-repeat="category in $ctrl.categories">\r\n\t\t<category-widget-component on-begin-edit="$ctrl.broadcastCloseAllOthers(except)" category="category"></category-widget-component>\r\n\t</li>\r\n\r\n\t<li ng-if="$ctrl.globals.adminEditMode && $ctrl.uncategorized.listingCount > 0">\r\n\t\t<a ui-sref="root-state.listings-state({category: \'uncategorized\'})">uncategorized ({{$ctrl.uncategorized.listingCount}})</a>\r\n\t</li>\r\n\t\r\n\t<li ng-if="$ctrl.globals.adminEditMode">\r\n\t\t<create-category-widget-component on-begin-edit="$ctrl.broadcastCloseAllOthers(except)"></create-category-widget-component>\r\n\t</li>\r\n</ul>'),t.put("category-widget-component.tpl",'<a href="" ng-if="!$ctrl.editing && $ctrl.globals.adminEditMode" ng-click="$ctrl.deleteCategory()">X</a>\r\n\r\n<a ng-if="!$ctrl.editing" ui-sref="root-state.listings-state({category: $ctrl.category.name})">{{$ctrl.category.name}} ({{$ctrl.category.listingCount}})</a>\r\n\r\n<a href="" ng-if="!$ctrl.editing && $ctrl.globals.adminEditMode" ng-click="$ctrl.beginEdit()">Edit</a>\r\n\r\n<form ng-if="$ctrl.editing" ng-submit="$ctrl.submitCategory()">\r\n\t<input id="category-edit-field" type="text" ng-model="$ctrl.newValue" required>\r\n\t<button type="submit">OK</button>\r\n\t<button type="button" ng-click="$ctrl.cancelEdit()">Cancel</button>\r\n</form>'),t.put("create-category-widget-component.tpl",'<a href="" ng-click="$ctrl.beginEdit()" ng-if="!$ctrl.editing">Add Category</a>\r\n<form ng-if="$ctrl.editing" ng-submit="$ctrl.submitCategory()">\r\n\t<input id="category-create-field" autofocus type="text" placeholder="new category" ng-model="$ctrl.categoryName" required>\r\n\t<button type="submit">OK</button>\r\n\t<button type="button" ng-click="$ctrl.cancelEdit()">Cancel</button>\r\n</form>'),t.put("footer-component.tpl","<h1>This is the Footer</h1>"),t.put("header-component.tpl",'<h1>This is the Header</h1>\r\n<a ui-sref="root-state.categories-state">Go home</a><br>\r\n<a ng-if="$ctrl.authenticationBindings.loggedIn" href="" ui-sref="root-state.new-listing-state">Post New Listing</a>\r\n<a href="" ng-if="$ctrl.authenticationBindings.loggedIn && $ctrl.authenticationBindings.admin && !$ctrl.globals.adminEditMode" ng-click="$ctrl.toggleAdminEditMode()">Edit Mode Off</a>\r\n<a href="" ng-if="$ctrl.authenticationBindings.loggedIn && $ctrl.authenticationBindings.admin && $ctrl.globals.adminEditMode" ng-click="$ctrl.toggleAdminEditMode()">Edit Mode On</a>\r\n<login-logout-widget-component></login-logout-widget-component>\r\n<a ng-if="$ctrl.authenticationBindings.loggedIn && $ctrl.authenticationBindings.admin" ui-sref="root-state.users-state">Users</a>\r\n<a ng-if="$ctrl.authenticationBindings.loggedIn && $ctrl.authenticationBindings.admin" ui-sref="root-state.listings-state({category: \'uncategorized\'})">uncategorized ({{$ctrl.uncategorized.listingCount}})</a>'),t.put("listing-component.tpl",'<h2>{{$ctrl.listing.title}}</h2>\r\n<p>{{$ctrl.listing.body}}</p>\r\n<p>{{$ctrl.listing.posterEmail}}</p>\r\n<p>This listing can be found in these categories:</p>\r\n<ul>\r\n\t<li ng-repeat="category in $ctrl.listing.categories">\r\n\t\t<a ui-sref="root-state.listings-state({category: category.name})">{{category.name}}</a>\r\n\t</li>\r\n</ul>\r\n<a ng-if="$ctrl.authenticationBindings.email === $ctrl.listing.posterEmail || $ctrl.authenticationBindings.admin" href="" ui-sref="root-state.edit-listing-state({listing: $ctrl.listing})">edit me</a>\r\n<a ng-if="$ctrl.authenticationBindings.email === $ctrl.listing.posterEmail || $ctrl.authenticationBindings.admin" href="" ng-click="$ctrl.deleteListing()">delete me</a>'),t.put("listing-form.tpl",'<form name="postListingForm" ng-submit="$ctrl.submitForm()">\r\n\t<input ng-model="$ctrl.listing.title"\r\n\t\t   type="text"\r\n\t\t   placeholder="title"\r\n\t\t   required>\r\n\t<br>\r\n\t<textarea ng-model="$ctrl.listing.body"\r\n\t\t\t  required></textarea>\r\n\t<br>\r\n<!-- \t<input ng-model="$ctrl.listing.posterEmail"\r\n\t\t   type="email"\r\n\t\t   placeholder="email@example.com"\r\n\t\t   required>\r\n\t<br> -->\r\n\t<label for="{{category.name + \'_checkbox\'}}"\r\n\t       ng-repeat-start="category in $ctrl.categories">{{category.name}}</label>\r\n\t<input id="{{category.name + \'_checkbox\'}}"\r\n\t       ng-model="$ctrl.checkboxesState[$index]"\r\n\t\t   ng-repeat-end\r\n\t\t   ng-true-value="\'{{category._id}}\'"\r\n\t\t   type="checkbox">\r\n\t<br>\r\n\t<button type="submit">Submit Form</button>\r\n</form>'),t.put("listings-component.tpl",'<ul>\r\n\t<li ng-repeat="listing in $ctrl.category.listings"><a ui-sref="root-state.listing-state({listingId: listing._id, category: $ctrl.category})">{{listing.title}}</a></li>\r\n</ul>\r\n<div ng-if="$ctrl.category.listingCount === 0">This category is empty</div>'),t.put("login-logout-widget-component.tpl",'<div nf-if="$ctrl.error" class="error-message">{{$ctrl.error}}</div>\r\n<a href="" ng-if="!$ctrl.formOpen && !$ctrl.bindings.loggedIn" ng-click="$ctrl.formOpen = true">Login</a>\r\n<span ng-if="$ctrl.bindings.loggedIn">Logged in as: {{$ctrl.bindings.email}}</span>\r\n<a href="" ng-if="$ctrl.bindings.loggedIn" ng-click="$ctrl.logout()">Logout</a>\r\n<form ng-if="$ctrl.formOpen" ng-submit="$ctrl.login()">\r\n\t<input type="text" ng-model="$ctrl.email" ng-change="$ctrl.error = \'\'">\r\n\t<input type="password" ng-model="$ctrl.password" ng-change="$ctrl.error = \'\'">\r\n\t<button type="submit">Login</button>\r\n\t<button type="button" ng-click="$ctrl.cancelLogin()">Cancel</button>\r\n</form>\r\n'),t.put("root-component.tpl",'<header class="site-header"><header-component uncategorized="$ctrl.uncategorized"></header-component></header>\r\n<main class="site-main" ui-view="content-view"></main>\r\n<footer class="site-footer"><footer-component></footer-component></footer>'),t.put("user-component.tpl",'<h1>{{$ctrl.user.email}}</h1>\r\n<p ng-if="$ctrl.user.admin">User is admin</p>\r\n<a href="" ui-sref="root-state.edit-user-state({user: $ctrl.user})">Edit me</a>\r\n<a href="" ng-click="$ctrl.deleteUser()" ng-if="$ctrl.authenticationBindings.email !== $ctrl.user.email">Delete me</a>'),t.put("user-form.tpl",'<form name="postListingForm" ng-submit="$ctrl.submitForm()">\r\n\t<input id="email-field" ng-model="$ctrl.user.email"\r\n\t\t   type="email"\r\n\t\t   placeholder="user@example.com"\r\n\t\t   required>\r\n\t<br>\r\n\t<label for="admin-checkbox">User is admin: </label>\r\n\t<input type="checkbox" ng-model="$ctrl.user.admin" ng-disabled="$ctrl.email && $ctrl.authenticationBindings.email === $ctrl.email">\r\n\t<br>\r\n\t<input type="password" ng-model="$ctrl.user.password" ng-required="!$ctrl.email" placeholder="password">\r\n\t<br>\r\n\t<input type="password" ng-model="$ctrl.user.passwordConfirmation" ng-required="!$ctrl.email" placeholder="confirm password">\r\n\t<br>\r\n\t<button type="submit">Submit Form</button>\r\n</form>'),t.put("user-widget-component.tpl",'<a href="" ng-if="!$ctrl.editing && $ctrl.globals.admin" ng-click="$ctrl.deleteUser()">X</a>\r\n\r\n<a ng-if="!$ctrl.editing" ui-sref="root-state.listings-state({category: $ctrl.category.name})">{{$ctrl.category.name}} ({{$ctrl.category.listingCount}})</a>\r\n\r\n<a href="" ng-if="!$ctrl.editing && $ctrl.globals.admin" ng-click="$ctrl.beginEdit()">Edit</a>\r\n\r\n<form ng-if="$ctrl.editing" ng-submit="$ctrl.submitCategory()">\r\n\t<input id="category-edit-field" type="text" ng-model="$ctrl.newValue" required>\r\n\t<button type="submit">OK</button>\r\n\t<button type="button" ng-click="$ctrl.cancelEdit()">Cancel</button>\r\n</form>'),t.put("users-component.tpl",'<ul>\r\n\t<li ng-repeat="user in $ctrl.users">\r\n\t\t<a ui-sref="root-state.user-state({email: user.email})">{{user.email}}</a>\r\n\t</li>\r\n\t<li>\r\n\t\t<a href="" ui-sref="root-state.new-user-state">Create new user</a>\r\n\t</li>\r\n</ul>')}])}();
!function(){"use strict";angular.module("mikeslist").component("categoriesComponent",{bindings:{categories:"<",uncategorized:"<"},controller:["$scope","globals",function(o,e){var t=this;t.globals=e,t.broadcastCloseAllOthers=function(e){o.$broadcast("close:forms",e)}}],templateUrl:"categories-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("categoryWidgetComponent",{bindings:{category:"<",onBeginEdit:"&"},controller:["$scope","$state","$timeout","categoriesService","globals",function(e,t,n,o,c){var i=this;i.editing=!1,i.globals=c,i.newValue="",i.$onInit=function(){i.newValue=i.category.name},i.beginEdit=function(){i.onBeginEdit({except:i.category}),i.editing=!0,n(function(){document.getElementById("category-edit-field").focus(),document.getElementById("category-edit-field").select()})},i.cancelEdit=function(){i.editing=!1,i.newValue=i.category.name},i.submitCategory=function(){o.editCategory(i.category.name,{name:i.newValue||""}).then(function(){i.editing=!1,t.go(t.current,{},{reload:!0})}).catch(function(e){n(function(){document.getElementById("category-edit-field").focus(),document.getElementById("category-edit-field").select()}),window.alert(e.data.error),console.error(e)})},i.deleteCategory=function(){o.removeCategory(i.category.name).then(function(){t.go(t.current,{},{reload:!0})}).catch(function(e){window.alert(e.data.error),console.error(e)})},e.$on("close:forms",function(e,t){t._id!==i.category._id&&i.cancelEdit()})}],templateUrl:"category-widget-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("createCategoryWidgetComponent",{bindings:{onBeginEdit:"&"},controller:["$scope","$state","$timeout","categoriesService","globals",function(e,t,n,o,c){var i=this;i.editing=!1,i.categoryName="",i.globals=c,i.beginEdit=function(){i.onBeginEdit({except:"new"}),i.editing=!0,n(function(){document.getElementById("category-create-field").focus()})},i.cancelEdit=function(){i.editing=!1,i.categoryName=""},i.submitCategory=function(){o.createCategory(i.categoryName).then(function(){i.editing=!1,t.go(t.current,{},{reload:!0})}).catch(function(e){n(function(){document.getElementById("category-create-field").focus(),document.getElementById("category-create-field").select()}),window.alert(e.data.error),console.error(e)})},e.$on("close:forms",function(e,t){"new"!==t&&i.cancelEdit()})}],templateUrl:"create-category-widget-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("createUserFormComponent",{controller:["$state","$timeout","usersService",function(e,o,r){var s=this;s.user={},s.submitForm=function(){return s.user.password&&s.user.passwordConfirmation&&s.user.password===s.user.passwordConfirmation?void r.createUser(s.user).then(function(o){e.go("root-state.user-state",{email:o.email},{reload:!0})}).catch(function(e){window.alert(e.data.error),console.log(e),s.user.password="",s.user.passwordConfirmation="",o(function(){document.getElementById("email-field").focus(),document.getElementById("email-field").select()})}):(window.alert("Passwords do not match!"),s.user.password="",void(s.user.passwordConfirmation=""))}}],templateUrl:"user-form.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("editListingFormComponent",{bindings:{categories:"<"},controller:["$scope","$state","$stateParams","$timeout","listingsService",function(t,i,n,e,o){var s=this;s.listing={categories:[]},s.checkboxesState=[],s.$onInit=function(){var t=s.categories.map(function(t){return t._id});Object.assign(s.listing,n.listing);var i=s.listing.categories.map(function(t){return t._id});s.checkboxesState=t.map(function(t){return i.indexOf(t)!==-1&&t})},t.$watch(function(){return s.checkboxesState},function(){s.listing.categories=s.checkboxesState.filter(function(t){return t})},!0),s.submitForm=function(){0===s.listing.categories.length?window.alert("You must pick at least 1 category"):o.editListing(n.listing._id,s.listing).then(function(){i.go("root-state.listing-state",{listingId:s.listing._id},{reload:!0})}).catch(function(t){window.alert(t.data.error),console.error(t),i.go("root-state.listing-state",{listingId:n.listing._id},{reload:!0})})}}],templateUrl:"listing-form.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("editUserFormComponent",{controller:["$state","$timeout","$stateParams","usersService","authenticationService",function(e,t,s,o,r){var n=this;n.user={},n.email="",n.authenticationBindings=r.bindings,n.$onInit=function(){n.email=s.user.email,Object.assign(n.user,s.user)},n.submitForm=function(){return n.user.password&&n.user.passwordConfirmation&&n.user.password!==n.user.passwordConfirmation?(window.alert("Passwords do not match!"),delete n.user.password,void delete n.user.passwordConfirmation):void o.updateUser(n.email,n.user).then(function(t){e.go("root-state.user-state",{email:t.email},{reload:!0})}).catch(function(e){window.alert(e.data.error),console.log(e),n.user.password="",n.user.passwordConfirmation="",t(function(){document.getElementById("email-field").focus(),document.getElementById("email-field").select()})})}}],templateUrl:"user-form.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("footerComponent",{templateUrl:"footer-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("headerComponent",{bindings:{uncategorized:"<"},controller:["globals","authenticationService",function(n,i){var t=this;t.globals=n,t.authenticationBindings=i.bindings,t.toggleAdminEditMode=function(){n.adminEditMode=!n.adminEditMode}}],templateUrl:"header-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("listingComponent",{bindings:{listing:"<"},controller:["authenticationService","listingsService","$state","$stateParams",function(t,e,n,i){var o=this;o.authenticationBindings=t.bindings,o.deleteListing=function(){window.confirm("Are you sure you want to permanently delete this listing?")&&e.deleteListing(o.listing._id).then(function(){i.category.name?n.go("root-state.listings-state",{category:i.category.name},{reload:!0}):n.go("root-state.categories-state",{},{reload:!0})}).catch(function(t){window.alert(t.data.error),console.error(t),n.go(n.current,{},{reload:!0})})}}],templateUrl:"listing-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("listingsComponent",{bindings:{category:"<"},templateUrl:"listings-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("loginLogoutWidgetComponent",{controller:["$window","$state","userLoginService","authenticationService",function(o,n,t,e){var r=this;r.formOpen=!1,r.bindings=e.bindings,r.login=function(){t.login(r.email,r.password).then(function(){r.cancelLogin()}).catch(function(o){r.email="",r.password="",403===o.status?r.error="Invalid email or password":(r.error="Error logging in, contact site owner",console.error(o))})},r.logout=function(){t.logout().then(function(){n.go(n.current,{},{reload:!0})}).catch(function(o){console.error(o.data.error),console.error(o)})},r.cancelLogin=function(){r.email="",r.password="",r.formOpen=!1}}],templateUrl:"login-logout-widget-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("postListingFormComponent",{bindings:{categories:"<"},controller:["listingsService","$state","$scope",function(t,e,i){var o=this;o.listing={categories:[]},o.checkboxesState=[],i.$watch(function(){return o.checkboxesState},function(){o.listing.categories=o.checkboxesState.filter(function(t){return t})},!0),o.submitForm=function(){0===o.listing.categories.length?window.alert("You must pick at least 1 category"):t.postListing(o.listing).then(function(t){e.go("root-state.listing-state",{listingId:t._id},{reload:!0})}).catch(function(t){window.alert(t.data.error),console.error(t),e.go("root-state.categories-state",{},{reload:!0})})}}],templateUrl:"listing-form.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("rootComponent",{bindings:{uncategorized:"<"},templateUrl:"root-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("userComponent",{bindings:{user:"<"},controller:["usersService","authenticationService","$state",function(e,t,n){var i=this;i.authenticationBindings=t.bindings,i.deleteUser=function(){window.confirm("Are you sure you want to permanently delete this user?")&&e.deleteUser(i.user.email).then(function(){n.go("root-state.users-state")})}}],templateUrl:"user-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").component("userWidgetComponent",{bindings:{user:"<"},templateUrl:"user-widget-component"})}();
!function(){"use strict";angular.module("mikeslist").component("usersComponent",{bindings:{users:"<"},templateUrl:"users-component.tpl"})}();
!function(){"use strict";angular.module("mikeslist").service("authenticationService",["$window",function(i){var n=this;n.bindings={loggedIn:!1},n.check=function(){i.localStorage.email&&i.localStorage.token?(n.bindings.loggedIn=!0,n.bindings.email=i.localStorage.email,n.bindings.admin=JSON.parse(i.localStorage.admin)):(n.bindings.loggedIn=!1,delete n.bindings.email,delete n.bindings.admin)}}])}();
!function(){"use strict";angular.module("mikeslist").service("categoriesService",["$http",function(t){var e=this;e.getAllCategories=function(){return t.get("/api/v1/categories").then(function(t){return t.data.filter(function(t){return"uncategorized"!==t.name})})},e.getListingsForCategory=function(e){return t.get("/api/v1/category/"+e).then(function(t){return t.data})},e.createCategory=function(e){return t.post("/api/v1/category",{name:e}).then(function(t){return t.data})},e.editCategory=function(e,n){return t.put("/api/v1/category/"+e,n).then(function(t){return t.data})},e.removeCategory=function(e){return t.delete("/api/v1/category/"+e).then(function(t){return t.data})}}])}();
!function(){"use strict";angular.module("mikeslist").service("listingsService",["$http",function(t){var n=this;n.getListing=function(n){return t.get("/api/v1/listing/"+n).then(function(t){return t.data})},n.postListing=function(n){return t.post("/api/v1/listing",n).then(function(t){return t.data})},n.editListing=function(n,i){return t.put("/api/v1/listing/"+n,i).then(function(t){return t.data})},n.deleteListing=function(n){return t.delete("/api/v1/listing/"+n).then(function(t){return t.data})}}])}();
!function(){"use strict";function e(e){return{request:function(t){return e.localStorage.token&&(t.headers["x-access-token"]=e.localStorage.token),t}}}angular.module("mikeslist").factory("tokenInterceptor",e),e.$inject=["$window"]}();
!function(){"use strict";angular.module("mikeslist").service("userLoginService",["$http","$window","$q","authenticationService","globals",function(e,i,n,a,t){var l=this;l.login=function(t,l){return e.post("/login",{email:t,password:l}).then(function(e){return i.localStorage.email=e.data.email,i.localStorage.admin=e.data.admin,i.localStorage.token=e.data.token,a.bindings.loggedIn=!0,a.bindings.email=e.data.email,a.bindings.admin=e.data.admin,n.resolve({result:"success"})})},l.logout=function(){return delete i.localStorage.token,delete i.localStorage.email,delete i.localStorage.admin,delete a.bindings.email,delete a.bindings.admin,a.bindings.loggedIn=!1,t.adminEditMode=!1,n.resolve({result:"success"})}}])}();
!function(){"use strict";angular.module("mikeslist").service("usersService",["$http",function(t){var e=this;e.getAllUsers=function(){return t.get("/api/v1/users").then(function(t){return t.data})},e.getSingleUser=function(e){return t.get("/api/v1/user/"+e).then(function(t){return t.data})},e.createUser=function(e){return t.post("/api/v1/user",e).then(function(t){return t.data})},e.updateUser=function(e,n){return t.put("/api/v1/user/"+e,n).then(function(t){return t.data})},e.deleteUser=function(e){return t.delete("/api/v1/user/"+e).then(function(t){return t.data})}}])}();
//# sourceMappingURL=main.js.map
